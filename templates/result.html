{% extends "layout.html" %}

{% block title %}Results for {{ cve_id }}{% endblock %}

{% block content %}
    <div class="container-fluid pt-4 px-4">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-md-10 col-sm-12">
                <div class="bg-secondary rounded p-4">
                    <h1 class="text-center mb-4">Results for {{ cve_id }}</h1>

                    <div class="cve-summary mb-4">
                        <h2>Summary</h2>
                        <p><strong>Description:</strong> {{ description }}</p>

                        <p><strong>CVSS Score:</strong> 
                            <span class="badge bg-warning text-dark">{{ score }}</span>
                        </p>
                        <p><strong>Severity:</strong> 
                            <span class="badge {% if severity == 'HIGH' %} bg-danger {% elif severity == 'CRITICAL' %} bg-dark {% elif severity == 'MEDIUM' %} bg-warning {% else %} bg-success {% endif %}">{{ severity }}</span>
                        </p>
                        <p><strong>CVSS Vector:</strong> 
                            <span class="badge bg-warning text-dark">{{ vector }}</span>
                        </p>
                    </div>

                    <div class="affected-vendors mb-4">
                        <h3>Affected Vendors</h3>
                        {% if vendors %}
                            <table class="table table-striped table-bordered">
                                <thead>
                                    <tr>
                                        <th>Vendor</th>
                                        <th>Product</th>
                                        <th>Version</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for vendor in vendors %}
                                        {% for version in vendor.versions %}
                                            <tr>
                                                <td>{{ vendor.vendor }}</td>
                                                <td>{{ vendor.product }}</td>
                                                <td>{{ version.version }}</td>
                                                <td>{{ version.status }}</td>
                                            </tr>
                                        {% endfor %}
                                    {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <p>No affected vendors found for this CVE.</p>
                        {% endif %}
                    </div>

                    <div class="exploit-links mb-4">
                        <h3>Exploit-DB Links</h3>
                        {% if exploit_links %}
                            <table class="table table-striped table-bordered">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Verified</th>
                                        <th>Title</th>
                                        <th>Type</th>
                                        <th>Platform</th>
                                        <th>Author</th>
                                        <th>Download Link</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for exploit in exploit_links %}
                                        <tr>
                                            <td>{{ exploit.date }}</td>
                                            <td>{% if exploit.verified %}✔{% else %}✖{% endif %}</td>
                                            <td><a href="{{exploit.titlelink}}" target="_blank">{{ exploit.title }}</a></td>
                                            <td>{{ exploit.type }}</td>
                                            <td>{{ exploit.platform }}</td>
                                            <td>{{ exploit.author }}</td>
                                            <td>
                                                {% if exploit.download_link %}
                                                    <a href="{{ exploit.download_link }}" target="_blank">Download</a>
                                                {% else %}
                                                    No
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <p>No Exploit-DB links found for this CVE.</p>
                        {% endif %}
                    </div>

                    <div class="references mb-4">
                        <h3>References</h3>
                        <ul>
                            {% for ref in references %}
                                <li><a href="{{ ref }}" target="_blank">{{ ref }}</a></li>
                            {% endfor %}
                        </ul>
                    </div>

                    <form action="{{ url_for('download_report', cve_id=cve_id) }}" method="POST">
                        <input type="hidden" name="description" value="{{ description }}">
                        <input type="hidden" name="severity" value="{{ severity }}">
                        <input type="hidden" name="score" value="{{ score }}">
                    
                        <div class="mb-3">
                            <label for="file_type" class="form-label">Choose file type:</label>
                            <select name="file_type" id="file_type" class="form-select">
                                <option value="pdf">PDF</option>
                                <option value="docx">DOCX</option>
                                <option value="html">HTML</option>
                                <option value="md">Markdown (MD)</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Download Report</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
